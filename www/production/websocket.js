const{cpu:cpu}=require("node-os-utils"),formatTime=require("./utils/formatTime.js"),RequestStats=require("./database/models/RequestStats");module.exports=e=>{e.on("connection",(e=>{e.on("error",console.error),console.log("New WebSocket connection established.");const t=setInterval((async()=>{const t=await RequestStats.findOne({}),o=await cpu.usage();e.send(JSON.stringify({stats:{requests:t.requests,responses:t.responses},uptime:formatTime.full(process.uptime()),coll:{createdAt:`${t.createdAt.toLocaleTimeString()}, ${t.createdAt.toLocaleDateString()}`,updatedAt:`${t.updatedAt.toLocaleTimeString()}, ${t.updatedAt.toLocaleDateString()}`},cpuUsage:`${o}%`}))}),2e3);e.on("close",(()=>{console.log("WebSocket connection was closed."),clearInterval(t)}))})),console.log("WebSocket server is running")};