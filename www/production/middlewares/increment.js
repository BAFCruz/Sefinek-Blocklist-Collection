const{userAgents:userAgents}=require("./morgan.js"),parseCategoryFromLink=require("../utils/parseCategoryFromLink.js"),RequestStats=require("../database/models/RequestStats");module.exports.requests=async(e,s,r)=>{const t=e.headers["user-agent"];if(userAgents.includes(t))return r();const n=parseCategoryFromLink(e.url);try{const e={$inc:{"requests.all":1}};n&&200===s.statusCode&&(e.$inc[`requests.${n}`]=1,e.$inc["requests.blocklist"]=1),await RequestStats.findOneAndUpdate({},e,{upsert:!0,new:!0})}catch(e){console.error("Error updating request stats:",e)}finally{r()}},module.exports.errors=async e=>{const s={};try{e&&(s.$inc={[`responses.${e}`]:1}),await RequestStats.findOneAndUpdate({},s,{upsert:!0,new:!0})}catch(e){console.error("Error incrementing request count `errors`:",e)}};