const express=require("express"),helmet=require("helmet"),path=require("node:path"),WebSocket=require("ws"),timeout=require("./middlewares/timeout.js"),morgan=require("./middlewares/morgan.js"),limiter=require("./middlewares/ratelimit.js"),increment=require("./middlewares/increment.js"),{notFound:notFound,internalError:internalError}=require("./middlewares/other/errors.js");require("./database/mongoose.js");const app=express(),ws=new WebSocket.Server({port:process.env.WS_PORT});require("./websocket.js")(ws),app.set("trust proxy",1),app.set("view engine","ejs"),app.set("views",path.join(__dirname,"views")),app.use(helmet({contentSecurityPolicy:!1,crossOriginResourcePolicy:!1})),app.use(express.static(path.join(__dirname,"public"))),app.use(morgan.use),app.use(limiter),app.use(timeout()),app.use("/docs",express.static(path.join(__dirname,"..","docs"))),app.get("*",increment.requests),app.use(require("./routes/Main.js")),app.use(require("./routes/Blocklists/Deprecated.js")),app.use(require("./routes/Blocklists/Main.js")),app.use(require("./routes/Markdown.js")),app.use(require("./routes/API.js")),app.use(notFound),app.use(internalError),app.listen(process.env.PORT,(()=>{if("production"===process.env.NODE_ENV)try{process.send("ready")}catch(e){}else console.log(`Website https://blocklist.sefinek.net is running on http://127.0.0.1:${process.env.PORT}`)}));